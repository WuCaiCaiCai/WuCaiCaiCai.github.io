import{e as j,r as k}from"./index.C-7etoUd.js";const _={ASSETS_PREFIX:void 0,BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SITE:"https://WuCaiCaiCai.github.io",SSR:!1};function U(t){return"init"in t}function O(t){return!!t.write}function H(t){return"v"in t||"e"in t}function C(t){if("e"in t)throw t.e;if((_?"production":void 0)!=="production"&&!("v"in t))throw new Error("[Bug] atom state is not initialized");return t.v}const T=new WeakMap;function J(t){var n;return R(t)&&!!((n=T.get(t))!=null&&n[0])}function tt(t){const n=T.get(t);n?.[0]&&(n[0]=!1,n[1].forEach(s=>s()))}function W(t,n){let s=T.get(t);if(!s){s=[!0,new Set],T.set(t,s);const e=()=>{s[0]=!1};t.then(e,e)}s[1].add(n)}function R(t){return typeof t?.then=="function"}function $(t,n,s){if(!s.p.has(t)){s.p.add(t);const e=()=>s.p.delete(t);n.then(e,e)}}function G(t,n,s){var e;const o=new Set;for(const i of((e=s.get(t))==null?void 0:e.t)||[])o.add(i);for(const i of n.p)o.add(i);return o}const nt=(t,n,...s)=>n.read(...s),et=(t,n,...s)=>n.write(...s),ot=(t,n)=>{if(n.INTERNAL_onInit)return n.INTERNAL_onInit(t);if(n.unstable_onInit)return console.warn("[DEPRECATED] atom.unstable_onInit is renamed to atom.INTERNAL_onInit."),n.unstable_onInit(t)},st=(t,n,s)=>{var e;return(e=n.onMount)==null?void 0:e.call(n,s)},it=(t,n)=>{var s;const e=g(t),o=e[0],i=e[6],a=e[9];if((_?"production":void 0)!=="production"&&!n)throw new Error("Atom is undefined or null");let h=o.get(n);return h||(h={d:new Map,p:new Set,n:0},o.set(n,h),(s=i.i)==null||s.call(i,n),a?.(t,n)),h},ct=t=>{const n=g(t),s=n[1],e=n[3],o=n[4],i=n[5],a=n[6],h=n[13],f=[],c=d=>{try{d()}catch(u){f.push(u)}};do{a.f&&c(a.f);const d=new Set,u=d.add.bind(d);e.forEach(p=>{var l;return(l=s.get(p))==null?void 0:l.l.forEach(u)}),e.clear(),i.forEach(u),i.clear(),o.forEach(u),o.clear(),d.forEach(c),e.size&&h(t)}while(e.size||i.size||o.size);if(f.length)throw new AggregateError(f)},ut=t=>{const n=g(t),s=n[1],e=n[2],o=n[3],i=n[11],a=n[14],h=n[17],f=[],c=new WeakSet,d=new WeakSet,u=Array.from(o);for(;u.length;){const p=u[u.length-1],l=i(t,p);if(d.has(p)){u.pop();continue}if(c.has(p)){if(e.get(p)===l.n)f.push([p,l]);else if((_?"production":void 0)!=="production"&&e.has(p))throw new Error("[Bug] invalidated atom exists");d.add(p),u.pop();continue}c.add(p);for(const v of G(p,l,s))c.has(v)||u.push(v)}for(let p=f.length-1;p>=0;--p){const[l,v]=f[p];let b=!1;for(const r of v.d.keys())if(r!==l&&o.has(r)){b=!0;break}b&&(a(t,l),h(t,l)),e.delete(l)}},L=new WeakSet,rt=(t,n)=>{var s,e;const o=g(t),i=o[1],a=o[2],h=o[3],f=o[6],c=o[7],d=o[11],u=o[12],p=o[13],l=o[14],v=o[16],b=o[17],r=d(t,n);if(H(r)){if(i.has(n)&&a.get(n)!==r.n)return r;let S=!1;for(const[D,E]of r.d)if(l(t,D).n!==E){S=!0;break}if(!S)return r}r.d.clear();let A=!0;function m(){i.has(n)&&(b(t,n),p(t),u(t))}function I(S){var D;if(S===n){const F=d(t,S);if(!H(F))if(U(S))B(t,S,S.init);else throw new Error("no atom init");return C(F)}const E=l(t,S);try{return C(E)}finally{r.d.set(S,E.n),J(r.v)&&$(n,r.v,E),i.has(n)&&((D=i.get(S))==null||D.t.add(n)),A||m()}}let w,y;const Z={get signal(){return w||(w=new AbortController),w.signal},get setSelf(){return(_?"production":void 0)!=="production"&&!O(n)&&console.warn("setSelf function cannot be used with read-only atom"),!y&&O(n)&&(y=(...S)=>{if((_?"production":void 0)!=="production"&&A&&console.warn("setSelf function cannot be called in sync"),!A)try{return v(t,n,...S)}finally{p(t),u(t)}}),y}},z=r.n;try{(_?"production":void 0)!=="production"&&L.delete(t);const S=c(t,n,I,Z);return(_?"production":void 0)!=="production"&&L.has(t)&&console.warn("Detected store mutation during atom read. This is not supported."),B(t,n,S),R(S)&&(W(S,()=>w?.abort()),S.then(m,m)),(s=f.r)==null||s.call(f,n),r}catch(S){return delete r.v,r.e=S,++r.n,r}finally{A=!1,z!==r.n&&a.get(n)===z&&(a.set(n,r.n),h.add(n),(e=f.c)==null||e.call(f,n))}},at=(t,n)=>{const s=g(t),e=s[1],o=s[2],i=s[11],a=[n];for(;a.length;){const h=a.pop(),f=i(t,h);for(const c of G(h,f,e)){const d=i(t,c);o.set(c,d.n),a.push(c)}}},X=(t,n,...s)=>{const e=g(t),o=e[3],i=e[6],a=e[8],h=e[11],f=e[12],c=e[13],d=e[14],u=e[15],p=e[17];let l=!0;const v=r=>C(d(t,r)),b=(r,...A)=>{var m;const I=h(t,r);try{if(r===n){if(!U(r))throw new Error("atom not writable");(_?"production":void 0)!=="production"&&L.add(t);const w=I.n,y=A[0];B(t,r,y),p(t,r),w!==I.n&&(o.add(r),u(t,r),(m=i.c)==null||m.call(i,r));return}else return X(t,r,...A)}finally{l||(c(t),f(t))}};try{return a(t,n,v,b,...s)}finally{l=!1}},lt=(t,n)=>{var s;const e=g(t),o=e[1],i=e[3],a=e[6],h=e[11],f=e[15],c=e[18],d=e[19],u=h(t,n),p=o.get(n);if(p&&!J(u.v)){for(const[l,v]of u.d)if(!p.d.has(l)){const b=h(t,l);c(t,l).t.add(n),p.d.add(l),v!==b.n&&(i.add(l),f(t,l),(s=a.c)==null||s.call(a,l))}for(const l of p.d)if(!u.d.has(l)){p.d.delete(l);const v=d(t,l);v?.t.delete(n)}}},q=(t,n)=>{var s;const e=g(t),o=e[1],i=e[4],a=e[6],h=e[10],f=e[11],c=e[12],d=e[13],u=e[14],p=e[16],l=f(t,n);let v=o.get(n);if(!v){u(t,n);for(const b of l.d.keys())q(t,b).t.add(n);if(v={l:new Set,d:new Set(l.d.keys()),t:new Set},o.set(n,v),O(n)){const b=()=>{let r=!0;const A=(...m)=>{try{return p(t,n,...m)}finally{r||(d(t),c(t))}};try{const m=h(t,n,A);m&&(v.u=()=>{r=!0;try{m()}finally{r=!1}})}finally{r=!1}};i.add(b)}(s=a.m)==null||s.call(a,n)}return v},dt=(t,n)=>{var s,e;const o=g(t),i=o[1],a=o[5],h=o[6],f=o[11],c=o[19],d=f(t,n);let u=i.get(n);if(!u||u.l.size)return u;let p=!1;for(const l of u.t)if((s=i.get(l))!=null&&s.d.has(n)){p=!0;break}if(!p){u.u&&a.add(u.u),u=void 0,i.delete(n);for(const l of d.d.keys()){const v=c(t,l);v?.t.delete(n)}(e=h.u)==null||e.call(h,n);return}return u},B=(t,n,s)=>{const e=g(t)[11],o=e(t,n),i="v"in o,a=o.v;if(R(s))for(const h of o.d.keys())$(n,s,e(t,h));o.v=s,delete o.e,(!i||!Object.is(a,o.v))&&(++o.n,R(a)&&tt(a))},ft=(t,n)=>{const s=g(t)[14];return C(s(t,n))},ht=(t,n,...s)=>{const e=g(t),o=e[12],i=e[13],a=e[16];try{return a(t,n,...s)}finally{i(t),o(t)}},pt=(t,n,s)=>{const e=g(t),o=e[12],i=e[18],a=e[19],f=i(t,n).l;return f.add(s),o(t),()=>{f.delete(s),a(t,n),o(t)}},K=new WeakMap,g=t=>{const n=K.get(t);if((_?"production":void 0)!=="production"&&!n)throw new Error("Store must be created by buildStore to read its building blocks");return n};function vt(...t){const n={get(e){const o=g(n)[21];return o(n,e)},set(e,...o){const i=g(n)[22];return i(n,e,...o)},sub(e,o){const i=g(n)[23];return i(n,e,o)}},s=[new WeakMap,new WeakMap,new WeakMap,new Set,new Set,new Set,{},nt,et,ot,st,it,ct,ut,rt,at,X,lt,q,dt,B,ft,ht,pt,void 0].map((e,o)=>t[o]||e);return K.set(n,Object.freeze(s)),n}const Q={};let St=0;function It(t,n){const s=`atom${++St}`,e={toString(){return(Q?"production":void 0)!=="production"&&this.debugLabel?s+":"+this.debugLabel:s}};return typeof t=="function"?e.read=t:(e.init=t,e.read=gt,e.write=bt),e}function gt(t){return t(this)}function bt(t,n,s){return n(this,typeof s=="function"?s(t(this)):s)}function mt(){return vt()}let M;function At(){return M||(M=mt(),(Q?"production":void 0)!=="production"&&(globalThis.__JOTAI_DEFAULT_STORE__||(globalThis.__JOTAI_DEFAULT_STORE__=M),globalThis.__JOTAI_DEFAULT_STORE__!==M&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044"))),M}const _t={},wt=k.createContext(void 0);function Y(t){return k.useContext(wt)||At()}const V=t=>typeof t?.then=="function",x=t=>{t.status||(t.status="pending",t.then(n=>{t.status="fulfilled",t.value=n},n=>{t.status="rejected",t.reason=n}))},kt=j.use||(t=>{if(t.status==="pending")throw t;if(t.status==="fulfilled")return t.value;throw t.status==="rejected"?t.reason:(x(t),t)}),P=new WeakMap,N=(t,n)=>{let s=P.get(t);return s||(s=new Promise((e,o)=>{let i=t;const a=c=>d=>{i===c&&e(d)},h=c=>d=>{i===c&&o(d)},f=()=>{try{const c=n();V(c)?(P.set(c,s),i=c,c.then(a(c),h(c)),W(c,f)):e(c)}catch(c){o(c)}};t.then(a(t),h(t)),W(t,f)}),P.set(t,s)),s};function yt(t,n){const{delay:s,unstable_promiseStatus:e=!j.use}={},o=Y(),[[i,a,h],f]=k.useReducer(d=>{const u=o.get(t);return Object.is(d[0],u)&&d[1]===o&&d[2]===t?d:[u,o,t]},void 0,()=>[o.get(t),o,t]);let c=i;if((a!==o||h!==t)&&(f(),c=o.get(t)),k.useEffect(()=>{const d=o.sub(t,()=>{if(e)try{const u=o.get(t);V(u)&&x(N(u,()=>o.get(t)))}catch{}if(typeof s=="number"){setTimeout(f,s);return}f()});return f(),d},[o,t,s,e]),k.useDebugValue(c),V(c)){const d=N(c,()=>o.get(t));return e&&x(d),kt(d)}return c}function Et(t,n){const s=Y();return k.useCallback((...o)=>{if((_t?"production":void 0)!=="production"&&!("write"in t))throw new Error("not writable atom");return s.set(t,...o)},[s,t])}function Dt(t,n){return[yt(t),Et(t)]}export{Et as a,It as b,Dt as c,yt as u};
